<div class="productos-container">
  <!-- Header con título y botón de acción -->
  <div class="header-section">
    <div class="title-section">
      <h1 class="page-title">
        <span class="material-icons title-icon">inventory</span>
        Gestión de Productos
      </h1>
      <p class="page-subtitle">Administra el catálogo de productos de tu negocio</p>
    </div>
    
    <button 
      class="fab-button" 
      (click)="mostrarFormulario()"
      [disabled]="!roleService.isAdmin()"
    >
      <span class="material-icons">add</span>
      Nuevo Producto
    </button>
  </div>

  <!-- Formulario de Producto -->
  <div class="form-card" *ngIf="mostrarForm">
    <div class="form-header">
      <h2 class="form-title">
        <span class="material-icons">{{ productoEditando ? 'edit' : 'add_box' }}</span>
        {{ productoEditando ? 'Editar Producto' : 'Nuevo Producto' }}
      </h2>
    </div>
    
    <form (ngSubmit)="guardarProducto()" #productoForm="ngForm" class="product-form">
      <div class="form-row">
        <div class="form-field">
          <label class="field-label">Nombre del Producto *</label>
          <input 
            type="text" 
            class="material-input" 
            [(ngModel)]="producto.nombre" 
            name="nombre" 
            required
            placeholder="Ingresa el nombre del producto"
          >
        </div>
        
        <div class="form-field">
          <label class="field-label">Precio *</label>
          <div class="input-with-prefix">
            <span class="input-prefix">$</span>
            <input 
              type="number" 
              step="0.01" 
              class="material-input with-prefix" 
              [(ngModel)]="producto.precio" 
              name="precio" 
              required
              placeholder="0.00"
            >
          </div>
        </div>
        
        <div class="form-field">
          <label class="field-label">Stock Inicial</label>
          <input 
            type="number" 
            class="material-input" 
            [(ngModel)]="producto.stock" 
            name="stock"
            placeholder="0"
          >
        </div>
      </div>
      
      <div class="form-field full-width">
        <label class="field-label">Descripción</label>
        <textarea 
          class="material-textarea" 
          [(ngModel)]="producto.descripcion" 
          name="descripcion" 
          rows="3"
          placeholder="Describe las características del producto..."
        ></textarea>
      </div>
      
      <div class="form-actions">
        <button 
          type="submit" 
          class="primary-button" 
          [disabled]="!productoForm.valid"
        >
          <span class="material-icons">{{ productoEditando ? 'update' : 'save' }}</span>
          {{ productoEditando ? 'Actualizar' : 'Guardar' }}
        </button>
        <button 
          type="button" 
          class="secondary-button" 
          (click)="cancelarEdicion()"
        >
          <span class="material-icons">cancel</span>
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de Productos -->
  <div class="table-card">
    <div class="table-header">
      <h3 class="table-title">
        <span class="material-icons">list</span>
        Lista de Productos
      </h3>
      
      <div class="search-container">
        <span class="material-icons search-icon">search</span>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Buscar productos..." 
          [(ngModel)]="terminoBusqueda" 
          (input)="filtrarProductos()"
        >
      </div>
    </div>
    
    <div class="table-container">
      <table class="products-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Producto</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let producto of productosFiltrados" class="table-row">
            <td class="id-cell">{{ producto.id }}</td>
            <td class="name-cell">
              <div class="product-info">
                <span class="product-name">{{ producto.nombre }}</span>
              </div>
            </td>
            <td class="price-cell">
              <span class="price-value">${{ producto.precio | number:'1.2-2' }}</span>
            </td>
            <td class="stock-cell">
              <span class="stock-badge" [ngClass]="{
                'stock-low': producto.stock < 10,
                'stock-medium': producto.stock >= 10 && producto.stock < 50,
                'stock-high': producto.stock >= 50
              }">
                {{ producto.stock }}
              </span>
            </td>
            <td class="description-cell">
              <span class="description-text">{{ producto.descripcion || 'Sin descripción' }}</span>
            </td>
            <td class="status-cell">
              <span class="status-badge" [ngClass]="{'active': producto.activo, 'inactive': !producto.activo}">
                <span class="material-icons status-icon">
                  {{ producto.activo ? 'check_circle' : 'cancel' }}
                </span>
                {{ producto.activo ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td class="actions-cell">
              <button 
                class="action-button edit-button" 
                (click)="editarProducto(producto)"
                title="Editar producto"
              >
                <span class="material-icons">edit</span>
              </button>
              <button 
                class="action-button delete-button" 
                (click)="eliminarProducto(producto.id!)"
                title="Eliminar producto"
              >
                <span class="material-icons">delete</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div *ngIf="productosFiltrados.length === 0" class="empty-state">
      <span class="material-icons empty-icon">inventory_2</span>
      <h3>No se encontraron productos</h3>
      <p>{{ terminoBusqueda ? 'Intenta con otros términos de búsqueda' : 'Comienza agregando tu primer producto' }}</p>
    </div>
  </div>

  <!-- Botón de navegación -->
  <div class="navigation-section">
    <button class="back-button" (click)="volverAlMenu()">
      <span class="material-icons">arrow_back</span>
      Volver al Menú
    </button>
  </div>
</div>
